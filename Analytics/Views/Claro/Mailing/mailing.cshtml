@{
    Layout = "~/Views/master.cshtml";
}


<div ng-controller="ctrl-claro-mailing">
    <div>

        <!-- HEADER-->
        <header class="page-header">
            <div class="page-name">Importar Job Claro Digital</div>
        </header>

        <!-- FILTROS -->
        <div class="row margin-bottom" >
            <div class="col-xs-12 col-md-12">
                <div class="card">
                    <div class="card-header">
                        <span class="card-header-title">Filtros</span>
                    </div>
                    <div class="card-body">
                        <div class="row">

                            <div class="col-xs-12 col-md-6">

                                <!--EMPRESA-->
                                <div class="form-group">
                                    <div class="col-md-6">
                                        <label class="control-sidebar-subheading">Empresa</label>
                                            <select ng-model="diario.empresa" class="form-control">
                                                <option value="4">Selecione</option>
                                                <option value="5">Claro Movel</option>
                                                <option value="6">Claro TV</option>
                                            </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label>Id Job</label> <input maxlength="10" ng-model="diario.job" class="form-control" type="text" name="number">
                                    </div>
                                </div>


                                <div class="row">
                                    <!--BOTÃO-->
                                    <div class="col-xs-12" style="margin-top:20px">
                                        <button type="button" class="btn btn-primary" style="float: right;" data-toggle="control-sidebar" ng-click="executeProcedure()">Gerar</button>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>


<script>
    angular.module('app').controller('ctrl-claro-mailing', function ($scope, $http, $filter, $interval) {
        // filtros iniciais
        let hoje = new Date();

        $scope.diario = {
            empresa: '4',
            job:''

        };


        // inserir nova ocorrencia
        $scope.executeProcedure = function ($event) 
        {

            if (!$scope.diario.job) {
                $('[ng-model="diario.job"]').focus();
                $event.stopPropagation();
                return false;
            }


            if (!$scope.diario.empresa) {
                $('[ng-model="diario.empresa"]').focus();
                $event.stopPropagation();
                return false;
            }

            $http({
                method: 'POST',
                url: "/api/intersic/importjob",
                data: $scope.diario,
            }).then(function success(r) {
                

                $scope.sucesso();

              
            });
        }

        $scope.sucesso = function ()
        {
            var empresanome  =""
            switch ($scope.diario.empresa) {
                case "5":
                    empresanome = "CLARO MOVEL";
                    break;
                case "6":
                    empresanome = "CLARO TV";
                    break;
            }


            alert("Job " + $scope.diario.job + ", da Empresa: " + empresanome + " gerado com sucesso!");

            $scope.diario.empresa = '4';
            $scope.diario.job = '';
        }


    });
</script>
