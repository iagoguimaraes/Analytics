@{
    Layout = "~/Views/master.cshtml";
}

<div ng-controller="ctrl-telecom">
    <div>

        <!--HEADER-->
        <header class="page-header">
            <div class="page-name">Cadastro de Operadora</div>
        </header>

        <!--TABELA-->
        <div class="col-xs-12 margin-bottom">
            <div class="card">
                <div class="card-header">
                    <span class="card-header-title">Operadoras</span>
                    <div class="card-header-button" ng-click="extrair()">
                        <i class="fa fa-file-excel-o"></i>
                    </div>
                    <div class="card-header-button" data-toggle="modal" data-target="#modal">
                        <i class="fa fa-plus"></i> Inserir
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Operadora</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="r in dashboard.operadora">
                                    <td>{{r.id_operadora}}</td>
                                    <td>{{r.operadora}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <!-- MODAL-->
        <div class="modal fade" id="modal" style="display: none;">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                        <h4 class="modal-title">Inserir Operadora</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xs-12">

                                <div class="form-group">
                                    <label class="control-sidebar-subheading">Operadora</label>
                                    <input type="text" ng-model="inserir.operadora" />
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Fechar</button>
                        <button type="button" class="btn btn-success pull-right" data-dismiss="modal" ng-click="incluir()">Inserir</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

    </div>
</div>

<script>
    angular.module('app').controller('ctrl-telecom', function ($scope, $http, $filter) {

        $scope.dashboard = {};
        $scope.inserir = {};

        $scope.carregarDados = function () {
            $http({
                method: 'POST',
                url: "/api/telecom/filtros",
            }).then(function success(r) {
                $scope.dashboard.operadora = r.data.Table2;
            });
        };

        $scope.carregarDados();

        $scope.incluir = function () {

            $http({
                method: 'POST',
                url: "/api/telecom/inserir/operadora",
                data: $scope.inserir
            }).then(function success(r) {
                $scope.carregarDados();
            });  
        }

        $scope.extrair = function () {
            alasql('SELECT * INTO XLSX("analytics.xlsx", {headers: true}) FROM ?', [$scope.dashboard.operadora]);
        }

    });
</script>