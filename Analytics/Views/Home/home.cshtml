@{
    Layout = "~/Views/master.cshtml";
}


<div ng-controller="ctrl-paginainicial">

    <!-- DAHSBOARD -->
    <div ng-if="dashboard.status == 200">

        <!-- HEADER-->
        <header class="page-header">
            <div class="page-name">
                Bem-Vindo {{dashboard.usuario.nome}}!
            </div>
        </header>

        <div class="row margin-bottom">
            <!-- REQ POR DIA-->
            <div class="col-xs-12 col-md-6">
                <div class="card">
                    <div class="card-header">
                        <span class="card-header-title">Consultas por Dia</span>
                        <div class="card-header-button card-header-expand">
                            <i class="fa fa-expand"></i>
                        </div>
                    </div>
                    <div class="card-body">
                        <high-chart series="dashboard.reqdia" axis-Categories="dashboard.datas" plot-Options-Line-Data-Label="true"></high-chart>
                    </div>
                </div>
            </div>

            <!-- DASHS FAVORITOS-->
            <div class="col-xs-12 col-md-6">
                <div class="card">
                    <div class="card-header">
                        <span class="card-header-title">Meus Dashboards favoritos</span>
                        <div class="card-header-button card-header-expand">
                            <i class="fa fa-expand"></i>
                        </div>
                    </div>
                    <div class="card-body">
                        <high-chart series="dashboard.reqdash" type="pie" tooltip-Point-Format="{point.y} (<b>{point.percentage:.1f}%</b>)"></high-chart>
                    </div>
                </div>
            </div>
        </div>

        <!-- TABELA DE ATUALIZAÇÕES -->
        <div class="row margin-bottom">
            <div class="col-xs-12">
                <div class="card">
                    <div class="card-header">
                        <span class="card-header-title">Tabela de Atualização do Analytics</span>
                        <div class="card-header-button card-header-expand">
                            <i class="fa fa-expand"></i>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped table-bordered table-sm">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Ordem</th>
                                    <th>Horário da Atualização</th>
                                    <th>Período Referencia dos Dados</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>D-1</td>
                                    <td>07:00</td>
                                    <td>00:00 até 23:59 do dia anterior</td>
                                </tr>
                                <tr>
                                    <td>08h</td>
                                    <td>09:40</td>
                                    <td>00:00 até 08:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>09h</td>
                                    <td>10:40</td>
                                    <td>00:00 até 09:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>10h</td>
                                    <td>11:40</td>
                                    <td>00:00 até 10:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>11h</td>
                                    <td>12:40</td>
                                    <td>00:00 até 11:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>12h</td>
                                    <td>13:40</td>
                                    <td>00:00 até 12:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>13h</td>
                                    <td>14:40</td>
                                    <td>00:00 até 13:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>14h</td>
                                    <td>15:40</td>
                                    <td>00:00 até 14:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>15h</td>
                                    <td>16:40</td>
                                    <td>00:00 até 15:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>16h</td>
                                    <td>17:40</td>
                                    <td>00:00 até 16:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>17h</td>
                                    <td>18:40</td>
                                    <td>00:00 até 17:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>18h</td>
                                    <td>19:40</td>
                                    <td>00:00 até 18:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>19h</td>
                                    <td>20:40</td>
                                    <td>00:00 até 19:59 do dia atual</td>
                                </tr>
                                <tr>
                                    <td>20h</td>
                                    <td>21:40</td>
                                    <td>00:00 até 20:59 do dia atual</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>

<script>
    angular.module('app').controller('ctrl-paginainicial', function ($scope, $http, $filter, $interval, dadosPagina) {
        dadosPagina.titulo = 'Página Inicial';
        dadosPagina.descricao = 'Analytics Credit Cash'

        $scope.dashboard = {};
        $scope.carregarDashboard = function () {
            $http({
                method: 'POST',
                url: "/api/analytics/paginainicial",
            }).then(function success(r) {
                $scope.dashboard.status = r.status;

                $scope.dashboard.usuario = r.data.Table[0];
                $scope.dashboard.grupos = r.data.Table1;
                $scope.dashboard.totalreq = r.data.Table2[0];

                $scope.dashboard.datas = r.data.Table3.map(obj => obj.data);
                $scope.dashboard.reqdia = [{ name: 'Requisições', data: r.data.Table3.map(obj => obj.quantidade) }];
                $scope.dashboard.reqdash = [{ name: 'Requisições', innerSize: '60%', data: r.data.Table4.map(obj => ({ name: obj.dashboard, y: obj.quantidade })) }];
            });
        }

        $scope.carregarDashboard();
    });
</script>
