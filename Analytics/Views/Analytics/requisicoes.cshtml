@{
    Layout = "~/Views/master.cshtml";
}

<div ng-controller="ctrl-requisicoes">
    <input type="button" value="Atualizar" ng-click="Refresh()"/>
    <div id="reportContainer" style="position: absolute; height: calc(100% - 20px); width: calc(100% - 20px);"></div>
</div>

<script>
    angular.module('app').controller('ctrl-requisicoes', function ($scope, $http) {

        $scope.report = {};

        $http({
            method: 'POST',
            url: "/api/analytics/requisicoes",
            data: $scope.model,
        }).then(function success(r) {

            let accessToken = r.data.EmbedToken.token;
            let embedUrl = r.data.EmbedUrl;
            let embedReportId = r.data.Id;
            let models = window['powerbi-client'].models;
            let config = {
                type: 'report',
                tokenType: models.TokenType.Embed,
                accessToken: accessToken,
                embedUrl: embedUrl,
                id: embedReportId,
                permissions: models.Permissions.All,
                settings: {
                    filterPaneEnabled: true,
                    navContentPaneEnabled: true
                },
                viewMode: models.ViewMode.View,
            };
            let reportContainer = $('#reportContainer')[0];
            $scope.report = powerbi.embed(reportContainer, config);
        });

        $scope.Refresh = function () {
            $scope.report.refresh();
        };

    });

</script>
