@{
    Layout = "~/Views/master.cshtml";
}


<div ng-controller="ctrl-semparar-comparativo">
    <div ng-if="dashboard.status == 200">

        <!-- HEADER-->
        <header class="page-header">
            <div class="page-name">Gráfico Comparativo</div>
            <div class="page-menu-button" ng-style="{'background-color': credor.cor_primaria, 'color': credor.cor_fonte_primaria}" onclick="toggleDisplayNone('filtros-window')">
                <i class="fa fa-filter"></i>
                FILTROS
            </div>
        </header>

        <!-- FILTROS -->
        <div class="row margin-bottom" ng-if="dashFiltros.status == 200">
            <div class="col-xs-12">
                <div id="filtros-window" class="card display-none">
                    <div class="card-header">
                        <span class="card-header-title">Filtros</span>
                        <div class="card-header-button card-header-close">
                            <i class="fa fa-close"></i>
                        </div>
                        <div class="card-header-button card-header-expand">
                            <i class="fa fa-expand"></i>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- PERIODO 1 -->
                            <div class="col-xs-12 col-sm-6">
                                <fieldset>
                                    <legend>Periodo 1 (Presente) </legend>

                                    <!--DATAS-->
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-6">
                                            <!--DATA INCIAL-->
                                            <div class="form-group">
                                                <label class="control-sidebar-subheading">Data Inicial</label>
                                                <div class="input-group date">
                                                    <div class="input-group-addon">
                                                        <i class="fa fa-calendar"></i>
                                                    </div>
                                                    <date-picker class="form-control pull-right" placeholder="yyyy-mm-dd" ng-model="filtros.dtini"></date-picker>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xs-12 col-sm-6">
                                            <!--DATA FINAL-->
                                            <div class="form-group">
                                                <label class="control-sidebar-subheading">Data Final</label>
                                                <div class="input-group date">
                                                    <div class="input-group-addon">
                                                        <i class="fa fa-calendar"></i>
                                                    </div>
                                                    <date-picker class="form-control pull-right" placeholder="yyyy-mm-dd" ng-model="filtros.dtfim"></date-picker>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!--HORA INICIO-->
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-6">
                                            <div class="form-group">
                                                <label class="control-sidebar-subheading">Hora Inicio</label>
                                                <select class="form-control" ng-model="filtros.horaini">
                                                    <option value="7" selected="selected">07h</option>
                                                    <option value="8">08h</option>
                                                    <option value="9">09h</option>
                                                    <option value="10">10h</option>
                                                    <option value="11">11h</option>
                                                    <option value="12">12h</option>
                                                    <option value="13">13h</option>
                                                    <option value="14">14h</option>
                                                    <option value="15">15h</option>
                                                    <option value="16">16h</option>
                                                    <option value="17">17h</option>
                                                    <option value="18">18h</option>
                                                    <option value="19">19h</option>
                                                    <option value="20">20h</option>
                                                    <option value="21">21h</option>
                                                    <option value="22">22h</option>
                                                </select>
                                            </div>
                                        </div>


                                        <div class="col-xs-12 col-sm-6">
                                            <!--HORA FIM-->
                                            <div class="form-group">
                                                <label class="control-sidebar-subheading">Hora Final</label>
                                                <select class="form-control" ng-model="filtros.horafim">
                                                    <option value="7">07h</option>
                                                    <option value="8">08h</option>
                                                    <option value="9">09h</option>
                                                    <option value="10">10h</option>
                                                    <option value="11">11h</option>
                                                    <option value="12">12h</option>
                                                    <option value="13">13h</option>
                                                    <option value="14">14h</option>
                                                    <option value="15">15h</option>
                                                    <option value="16">16h</option>
                                                    <option value="17">17h</option>
                                                    <option value="18">18h</option>
                                                    <option value="19">19h</option>
                                                    <option value="20">20h</option>
                                                    <option value="21">21h</option>
                                                    <option value="22" selected="selected">22h</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!--EMPRESA-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Empresa</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.empresas" dados="dashFiltros.empresa" style="width:100%"></select2>
                                    </div>

                                    <!--CARTEIRA-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Carteira</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.carteiras" dados="dashFiltros.carteira" style="width:100%"></select2>
                                    </div>

                                    <!--FAIXA ATRASO-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Faixa Atraso</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.faixaAtraso" dados="dashFiltros.faixaAtraso" style="width:100%"></select2>
                                    </div>

                                    <!--PLANO-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Plano</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.plano" dados="dashFiltros.plano" style="width:100%"></select2>
                                    </div>

                                    <!--DEVEDOR-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Devedor</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.devedor" dados="dashFiltros.devedor" style="width:100%"></select2>
                                    </div>


                                    <!--BOTÃO-->
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary" data-toggle="control-sidebar" ng-click="carregarDashboard()">Carregar Dados</button>
                                    </div>
                                </fieldset>
                            </div>

                            <!-- PERIODO 2 -->
                            <div class="col-xs-12 col-sm-6">
                                <fieldset>
                                    <legend>Periodo 2 ( Passado )</legend>

                                    <!--DATAS-->
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-6">
                                            <!--DATA INCIAL-->
                                            <div class="form-group">
                                                <label class="control-sidebar-subheading">Data Inicial</label>
                                                <div class="input-group date">
                                                    <div class="input-group-addon">
                                                        <i class="fa fa-calendar"></i>
                                                    </div>
                                                    <date-picker class="form-control pull-right" placeholder="yyyy-mm-dd" ng-model="filtros.dtini_2"></date-picker>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xs-12 col-sm-6">
                                            <!--DATA FINAL-->
                                            <div class="form-group">
                                                <label class="control-sidebar-subheading">Data Final</label>
                                                <div class="input-group date">
                                                    <div class="input-group-addon">
                                                        <i class="fa fa-calendar"></i>
                                                    </div>
                                                    <date-picker class="form-control pull-right" placeholder="yyyy-mm-dd" ng-model="filtros.dtfim_2"></date-picker>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!--HORAS-->
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-6">
                                            <div class="form-group">
                                                <label class="control-sidebar-subheading">Hora Inicio</label>
                                                <select class="form-control" ng-model="filtros.horaini_2">
                                                    <option value="7" selected="selected">07h</option>
                                                    <option value="8">08h</option>
                                                    <option value="9">09h</option>
                                                    <option value="10">10h</option>
                                                    <option value="11">11h</option>
                                                    <option value="12">12h</option>
                                                    <option value="13">13h</option>
                                                    <option value="14">14h</option>
                                                    <option value="15">15h</option>
                                                    <option value="16">16h</option>
                                                    <option value="17">17h</option>
                                                    <option value="18">18h</option>
                                                    <option value="19">19h</option>
                                                    <option value="20">20h</option>
                                                    <option value="21">21h</option>
                                                    <option value="22">22h</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-6">
                                            <div class="form-group">
                                                <label class="control-sidebar-subheading">Hora Final</label>
                                                <select class="form-control" ng-model="filtros.horafim_2">
                                                    <option value="7">07h</option>
                                                    <option value="8">08h</option>
                                                    <option value="9">09h</option>
                                                    <option value="10">10h</option>
                                                    <option value="11">11h</option>
                                                    <option value="12">12h</option>
                                                    <option value="13">13h</option>
                                                    <option value="14">14h</option>
                                                    <option value="15">15h</option>
                                                    <option value="16">16h</option>
                                                    <option value="17">17h</option>
                                                    <option value="18">18h</option>
                                                    <option value="19">19h</option>
                                                    <option value="20">20h</option>
                                                    <option value="21">21h</option>
                                                    <option value="22" selected="selected">22h</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!--EMPRESA-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Empresa</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.empresas_2" dados="dashFiltros.empresa" style="width:100%"></select2>
                                    </div>

                                    <!--CARTEIRA-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Carteira</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.carteiras_2" dados="dashFiltros.carteira" style="width:100%"></select2>
                                    </div>

                                    <!--FAIXA ATRASO-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Faixa Atraso</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.faixaAtraso_2" dados="dashFiltros.faixaAtraso" style="width:100%"></select2>
                                    </div>

                                    <!--PLANO-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Plano</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.plano_2" dados="dashFiltros.plano" style="width:100%"></select2>
                                    </div>

                                    <!--DEVEDOR-->
                                    <div class="form-group">
                                        <label class="control-sidebar-subheading">Devedor</label>
                                        <select2 class="form-control" data-placeholder="Selecione" ng-model="filtros.devedor_2" dados="dashFiltros.devedor" style="width:100%"></select2>
                                    </div>

                                </fieldset>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GRAFICO E QUADROS -->
        <div class="row">
            <div class="col-xs-12 margin-bottom">
                <div class="card">
                    <div class="card-header">

                        <div class="card-header-title">
                            Comparar {{grafico.indicador}} por :
                        </div>
                        <div class="card-header-title">
                            <select style="margin-left: 20px" class="form-control" ng-model="filtros.visao" ng-change="carregarDashboard()">
                                <option value="hora" selected="selected">Hora</option>
                                <option value="dia">Dia do Mês</option>
                                <option value="dia_semana">Dia da Semana</option>
                                <option value="semana">Semana do Mês</option>
                                <option value="mes">Mês do Ano</option>
                            </select>
                        </div>
                        <div class="card-header-button card-header-expand">
                            <i class="fa fa-expand"></i>
                        </div>
                        <div class="card-header-button" ng-click="extrair('Table')">
                            <i class="fa fa-file-excel-o"></i>
                        </div>
                    </div>
                    <div class="card-body">
                        <!--GRAFICO-->
                        <high-chart series="dashboard.series" axis-Categories="dashboard.categories" plot-Options-Line-Data-Label="true" plot-Options-Column-Data-Label="true"></high-chart>

                        <!--QUADROS -->
                        <div class="row">

                            <!--INDICADORES ABSOLUTOS-->
                            <div class="col-xs-12 col-sm-6 col-lg-2 ">
                                <div class="small-box" ng-class="dashboard.discado.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.discado.vs | percentage:1"></h3>
                                        <p>{{dashboard.discado.p1 | megaNumber}} vs {{dashboard.discado.p2 | megaNumber}}</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-phone"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'discado'" class="small-box-footer">Discado <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.contato.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.contato.vs | percentage:1"></h3>
                                        <p>{{dashboard.contato.p1 | megaNumber}} vs {{dashboard.contato.p2 | megaNumber}}</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-headphones"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'contato'" class="small-box-footer">Contato <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.cpc.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.cpc.vs | percentage:1"></h3>
                                        <p>{{dashboard.cpc.p1 | number}} vs {{dashboard.cpc.p2 | number}}</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-male"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'cpc'" class="small-box-footer">CPC <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.cpca.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.cpca.vs | percentage:1"></h3>
                                        <p>{{dashboard.cpca.p1 | number}} vs {{dashboard.cpca.p2 | number}}</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-street-view"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'cpca'" class="small-box-footer">CPCA <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.promessa.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.promessa.vs | percentage:1"></h3>
                                        <p>{{dashboard.promessa.p1 | number}} vs {{dashboard.promessa.p2 | number}}</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-thumbs-o-up"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'promessa'" class="small-box-footer">Promessa <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.acordo.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.acordo.vs | percentage:1"></h3>
                                        <p>{{dashboard.acordo.p1 | number}} vs {{dashboard.acordo.p2 | number}}</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-thumbs-o-up"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'acordo'" class="small-box-footer">Acordo <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <!--INDICADORES PERCENTUAIS e MAILING-->
                            <div class="col-xs-12 col-sm-6 col-lg-2 col-xs-offset-1">
                                <div class="small-box" ng-class="dashboard.hitrate.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.hitrate.vs | percentage:1"></h3>
                                        <p>{{dashboard.hitrate.p1 | percentage:1}} vs {{dashboard.hitrate.p2 | percentage:1}}</p>
                                        <p><h5> Dif : {{dashboard.difhitrate.dif | percentage:1}} </h5> </p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-bullseye"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'hitrate'" class="small-box-footer">Hit Rate <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.txloc.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.txloc.vs | percentage:1"></h3>
                                        <p>{{dashboard.txloc.p1 | percentage:1}} vs {{dashboard.txloc.p2 | percentage:1}}</p>
                                        <p><h5> Dif : {{dashboard.diftxloc.dif | percentage:1}} </h5> </p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-search"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'txloc'" class="small-box-footer">Tx Loc <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.txapv.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.txapv.vs | percentage:1"></h3>
                                        <p>{{dashboard.txapv.p1 | percentage:1}} vs {{dashboard.txapv.p2 | percentage:1}}</p>
                                        <p><h5> Dif : {{dashboard.diftxapv.dif | percentage:1}} </h5></p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-check"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'txapv'" class="small-box-footer">Tx Apv <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.conversaop.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.conversaop.vs | percentage:1"></h3>
                                        <p>{{dashboard.conversaop.p1 | percentage:1}} vs {{dashboard.conversaop.p2 | percentage:1}}</p>
                                        <p><h5> Dif : {{dashboard.difconversaop.dif | percentage:1}} </h5></p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-thumbs-up"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'conversaop'" class="small-box-footer">Conversão Prom. <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.conversaoa.vs >= 0 ? 'bg-green' : 'bg-red'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.conversaoa.vs | percentage:1"></h3>
                                        <p>{{dashboard.conversaoa.p1 | percentage:1}} vs {{dashboard.conversaoa.p2 | percentage:1}}</p>
                                        <p><h5> Dif : {{dashboard.difconversaoa.dif | percentage:1}} </h5></p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-thumbs-up"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'conversaoa'" class="small-box-footer">Conversão Acordo <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>

                            @*<div class="col-xs-12 col-sm-6 col-lg-2">
                                <div class="small-box" ng-class="dashboard.esforco.vs >= 0 ? 'bg-red' : 'bg-green'">
                                    <div class="inner">
                                        <h3 ng-bind="dashboard.esforco.vs | percentage:1"></h3>
                                        <p>{{dashboard.esforco.p1 | megaNumber }} vs {{dashboard.esforco.p2 | megaNumber }}</p>
                                        <p><h5> Dif : {{dashboard.difesforco.dif | number : 2 }} </h5></p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-thumbs-o-up"></i>
                                    </div>
                                    <a href="#" ng-click="grafico.indicador = 'esforco'" class="small-box-footer">Esforço <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>*@
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    angular.module('app').controller('ctrl-semparar-comparativo', function ($scope, $http, $filter, dadosPagina) {
        dadosPagina.titulo = 'Comparativo';
        dadosPagina.descricao = 'Sem Parar'

        // filtros iniciais
        let _dt1 = new Date();
        let _dt2 = new Date();
        _dt1.setDate(_dt1.getDate() - 1);
        _dt2.setDate(_dt2.getDate() - 2);
        _dt1 = $filter('date')(_dt1, "yyyy-MM-dd");
        _dt2 = $filter('date')(_dt2, "yyyy-MM-dd");

        $scope.filtros = {
            dtini: _dt1,
            dtfim: _dt1,
            dtini_2: _dt2,
            dtfim_2: _dt2,

            horaini: '7',
            horafim: '22',
            horaini_2: '7',
            horafim_2: '22',

            empresas: '',
            carteiras: '',
            faixaAtraso: '',
            plano: '',
            devedor: '',

            empresas_2: '',
            carteiras_2: '',
            faixaAtraso_2: '',
            plano_2: '',
            devedor_2: '',

            visao: 'hora',
        };

        $scope.dashFiltros = {};
        $scope.dashboard = {};
        $scope.grafico = { indicador: 'promessa' };

        // carregar os filtros
        $http({
            method: 'GET',
            url: "/api/semparar/dashboard/humano/filtros",
            data: $scope.filtros,
        }).then(function success(r) {
            let data = r.data;

            $scope.dashFiltros.status = r.status;
            $scope.dashFiltros.empresa = data.Table;
            $scope.dashFiltros.carteira = data.Table1;
            $scope.dashFiltros.faixaAtraso = data.Table2;
            $scope.dashFiltros.plano = data.Table5;
            $scope.dashFiltros.devedor = data.Table6;

        });

        // obtem filtros do escopo e carrega os dados do dashboard
        $scope.carregarDashboard = function () {
            $http({
                method: 'POST',
                url: "/api/semparar/dashboard/humano/comparativo",
                data: $scope.filtros,
            }).then(function success(r) {
                $scope.dashboard.status = r.status;
                $scope.dashboard.dados = r.data;

                $scope.carregarGrafico();
                $scope.carregarComparativo();
            });
        }

        $scope.carregarGrafico = function () {
            let indicador = $scope.grafico.indicador;

            $scope.dashboard.categories = $scope.dashboard.dados.Table.map(r => r.categoria);

            let series1, series2;
            switch (indicador) {
                case 'hitrate':
                    series1 = $scope.dashboard.dados.Table.map(obj => (obj.contato * 100 / obj.discado).toFixed(1) * 1);
                    series2 = $scope.dashboard.dados.Table.map(obj => (obj.contato2 * 100 / obj.discado2).toFixed(1) * 1);
                    break;
                case 'txloc':
                    series1 = $scope.dashboard.dados.Table.map(obj => (obj.cpc * 100 / obj.contato).toFixed(1) * 1);
                    series2 = $scope.dashboard.dados.Table.map(obj => (obj.cpc2 * 100 / obj.contato2).toFixed(1) * 1);
                    break;
                case 'txapv':
                    series1 = $scope.dashboard.dados.Table.map(obj => (obj.cpca * 100 / obj.cpc).toFixed(1) * 1);
                    series2 = $scope.dashboard.dados.Table.map(obj => (obj.cpca2 * 100 / obj.cpc2).toFixed(1) * 1);
                    break;
                case 'conversaop':
                    series1 = $scope.dashboard.dados.Table.map(obj => (obj.promessa * 100 / obj.cpca).toFixed(1) * 1);
                    series2 = $scope.dashboard.dados.Table.map(obj => (obj.promessa2 * 100 / obj.cpca2).toFixed(1) * 1);
                    break;
                case 'conversaoa':
                    series1 = $scope.dashboard.dados.Table.map(obj => (obj.acordo * 100 / obj.cpca).toFixed(1) * 1);
                    series2 = $scope.dashboard.dados.Table.map(obj => (obj.acordo2 * 100 / obj.cpca2).toFixed(1) * 1);
                    break;
                case 'esforco':
                    series1 = $scope.dashboard.dados.Table.map(obj => (obj.discado / obj.promessa).toFixed(1) * 1);
                    series2 = $scope.dashboard.dados.Table.map(obj => (obj.discado2 / obj.promessa2).toFixed(1) * 1);
                    break;
                default:
                    series1 = $scope.dashboard.dados.Table.map(obj => obj[indicador]);
                    series2 = $scope.dashboard.dados.Table.map(obj => obj[indicador + '2']);
            }


            if ($scope.filtros.visao == 'mes') {

                $scope.dashboard.series = [
                    { name: 'Período 1', data: series1, type: 'column' },
                    { name: 'Período 2', data: series2, type: 'column' }
                ];
            }
            else
                $scope.dashboard.series = [
                    { name: 'Período 1', data: series1, type: 'line' },
                    { name: 'Período 2', data: series2, type: 'line', dashStyle: 'shortdot' }
                ];

        }

        $scope.carregarComparativo = function () {
            let dados1 = alasql('select sum(discado) discado, sum(contato) contato, sum(cpc) cpc, sum(cpca) cpca, sum(promessa) promessa, sum(acordo) acordo from ?', [$scope.dashboard.dados.Table])[0];
            let dados2 = alasql('select sum(discado2) discado, sum(contato2) contato, sum(cpc2) cpc, sum(cpca2) cpca, sum(promessa2) promessa, sum(acordo2) acordo from ?', [$scope.dashboard.dados.Table])[0];

            let calculo = {
                hitrate1: dados1.contato / dados1.discado,
                hitrate2: dados2.contato / dados2.discado,
                txloc1: dados1.cpc / dados1.contato,
                txloc2: dados2.cpc / dados2.contato,
                txapv1: dados1.cpca / dados1.cpc,
                txapv2: dados2.cpca / dados2.cpc,
                conversaop1: dados1.promessa / dados1.cpca,
                conversaop2: dados2.promessa / dados2.cpca,
                conversaoa1: dados1.acordo / dados1.cpca,
                conversaoa2: dados2.acordo / dados2.cpca,
                esforco1: (dados1.discado / dados1.promessa).toFixed(2),
                esforco2: (dados2.discado / dados2.promessa).toFixed(2)
            }

            $scope.dashboard.discado = { p1: dados1.discado, p2: dados2.discado, vs: dados1.discado / dados2.discado - 1 };
            $scope.dashboard.contato = { p1: dados1.contato, p2: dados2.contato, vs: dados1.contato / dados2.contato - 1 };
            $scope.dashboard.cpc = { p1: dados1.cpc, p2: dados2.cpc, vs: dados1.cpc / dados2.cpc - 1 };
            $scope.dashboard.cpca = { p1: dados1.cpca, p2: dados2.cpca, vs: dados1.cpca / dados2.cpca - 1 };
            $scope.dashboard.promessa = { p1: dados1.promessa, p2: dados2.promessa, vs: dados1.promessa / dados2.promessa - 1 };
            $scope.dashboard.acordo = { p1: dados1.acordo, p2: dados2.acordo, vs: dados1.acordo / dados2.acordo - 1 };

            $scope.dashboard.hitrate = { p1: calculo.hitrate1, p2: calculo.hitrate2, vs: calculo.hitrate1 / calculo.hitrate2 - 1 };
            $scope.dashboard.txloc = { p1: calculo.txloc1, p2: calculo.txloc2, vs: calculo.txloc1 / calculo.txloc2 - 1 };
            $scope.dashboard.txapv = { p1: calculo.txapv1, p2: calculo.txapv2, vs: calculo.txapv1 / calculo.txapv2 - 1 };
            $scope.dashboard.conversaop = { p1: calculo.conversaop1, p2: calculo.conversaop2, vs: calculo.conversaop1 / calculo.conversaop2 - 1 };
            $scope.dashboard.conversaoa = { p1: calculo.conversaoa1, p2: calculo.conversaoa2, vs: calculo.conversaoa1 / calculo.conversaoa2 - 1 };

            $scope.dashboard.esforco = { p1: calculo.esforco1, p2: calculo.esforco2, vs: calculo.esforco1 / calculo.esforco2 - 1 };

            $scope.dashboard.difhitrate = { dif: calculo.hitrate1 - calculo.hitrate2 };
            $scope.dashboard.diftxloc = { dif: calculo.txloc1 - calculo.txloc2 };
            $scope.dashboard.diftxapv = { dif: calculo.txapv1 - calculo.txapv2 };
            $scope.dashboard.difconversaop = { dif: calculo.conversaop1 - calculo.conversaop2 };
            $scope.dashboard.difconversaoa = { dif: calculo.conversaoa1 - calculo.conversaoa2 };
            $scope.dashboard.difesforco = { dif: calculo.esforco1 - calculo.esforco2 };

        }

        $scope.carregarDashboard();

        $scope.$watch('grafico.indicador', function (newVal, oldVal) {
            if ($scope.dashboard.status == 200)
                $scope.carregarGrafico();
        });

        $scope.extrair = function (tabela) {
            alasql('SELECT * INTO XLSX("comparativo_analytics.xlsx", {headers: true}) FROM ?', [$scope.dashboard.dados[tabela]]);
        }

    });
</script>

