@{
    Layout = "~/Views/master.cshtml";
}

<div ng-controller="ctrl-riachuelosac">

    <!-- HEADER-->
    <header class="page-header">
        <div class="page-name">Relacionamento de Canais de Vendas</div>
    </header>

    <!--FILAS-->
    <div class="col-xs-12 col-lg-6 margin-bottom">
        <div class="card">
            <div class="card-header">
                <span class="card-header-title">Filas de Atendimento</span>
                <div class="card-header-button card-header-expand">
                    <i class="fa fa-expand"></i>
                </div>
            </div>
            <div class="card-body">
                <high-chart series="dashboard.grafico_fila" axis-Categories="dashboard.fila_categorias" type="bar" plot-Options-Bar-Data-Label="true" height="360"></high-chart>
            </div>
        </div>
    </div>

    <!--QTD PA-->
    <div class="col-xs-12 col-lg-6 margin-bottom">
        <div class="card">
            <div class="card-header">
                <span class="card-header-title">Quantidade de P.A</span>
                <div class="card-header-button card-header-expand">
                    <i class="fa fa-expand"></i>
                </div>
            </div>
            <div class="card-body">

                <div class="row">

                    <div class="col-xs-6">
                        <div class="small-box bg-green">
                            <div class="inner">
                                <h3 ng-bind="dashboard.pa"></h3>
                                <p>P.A</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-user"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-6">
                        <div class="small-box bg-blue">
                            <div class="inner">
                                <h3 ng-bind="dashboard.atendimentodia"></h3>
                                <p>Atend/Dia/PA</p>
                            </div>
                            <div class="icon">
                                <i class="fa fa-headphones"></i>
                            </div>
                        </div>
                    </div>


                </div>

                <div class="row">
                    <h4 class="text-center">Nível de Serviço: <b>{{dashboard.ns | percentage: 1}}</b></h4>
                    <div class="col-xs-12 text-center">
                        <gauge style="height: 193px;" config="dashboard.ns_gauge"></gauge>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!--FILAS-->
    <div class="col-xs-12 margin-bottom">
        <div class="card">
            <div class="card-header">
                <span class="card-header-title">Análise por Fila</span>
                <div class="card-header-button card-header-expand">
                    <i class="fa fa-expand"></i>
                </div>
            </div>
            <div class="card-body">
                <!--TABELA-->
                <div class="table-responsive">
                    <table class="table table-striped table-bordered" style="width:100%" ng-if="dashboard.fila">
                        <thead>
                            <tr>
                                <th>Fila</th>
                                <th>NS (20s)</th>
                                <th>Chamada</th>
                                <th>% do Total</th>
                                <th>Atendida</th>
                                <th>Abandonada</th>
                                <th>% Abandono</th>
                                <th>Tempo Médio Atendimento</th>
                                <th>Tempo Médio em Fila</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="f in dashboard.fila">
                                <td>{{f.fila}}</td>
                                <td>{{f.ns}}</td>
                                <td>{{f.chamada}}</td>
                                <td>{{f.perctt}}</td>
                                <td>{{f.atendido}}</td>
                                <td>{{f.abandonado}}</td>
                                <td>{{f.percaban}}</td>
                                <td>{{f.tma}}</td>
                                <td>{{f.tmf}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 col-md-6">
            <!--HORA HORA-->
            <div class="col-xs-12 margin-bottom">
                <div class="card">
                    <div class="card-header">
                        <span class="card-header-title">Gráfico por Hora</span>
                        <div class="card-header-button card-header-expand">
                            <i class="fa fa-expand"></i>
                        </div>
                    </div>
                    <div class="card-body">
                        <p><small>Chamadas deste mês</small></p>

                        <h4 class="text-center">Hora Hora</h4>
                        <high-chart class="margin-bottom" series="dashboard.graficohora_h" axis-Categories="dashboard.horas" type="column"
                                    plot-Options-Column-Stacking="normal" y-Axis1-Min="80"
                                    y-Axis1-Max="100" height="200"></high-chart>
                    </div>
                </div>
            </div>

            <!--TEMPOS-->
            <div class="col-xs-12 margin-bottom">
                <div class="card">
                    <div class="card-header">
                        <span class="card-header-title">Tempos Operação</span>
                        <div class="card-header-button card-header-expand">
                            <i class="fa fa-expand"></i>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">

                            <div class="col-xs-6">

                                <div class="small-box bg-gray">
                                    <div class="inner">
                                        <b>Logado:</b> <span ng-bind="dashboard.tempos_h.logado"></span>
                                    </div>
                                </div>

                                <div class="small-box bg-gray">
                                    <div class="inner">
                                        <b>TMA:</b> <span ng-bind="dashboard.tempos_h.tma"></span>
                                    </div>
                                </div>

                                <div class="small-box bg-gray">
                                    <div class="inner">
                                        <b>Tempo Fila:</b> <span ng-bind="dashboard.tempos_h.tmf"></span>
                                    </div>
                                </div>

                            </div>

                            <div class="col-xs-6">

                                <div class="small-box bg-green">
                                    <div class="inner">
                                        <b>Conversado:</b> <span ng-bind="dashboard.tempos_h.conversado"></span>
                                    </div>
                                </div>

                                <div class="small-box bg-yellow">
                                    <div class="inner">
                                        <b>Pausas:</b> <span ng-bind="dashboard.tempos_h.pausas"></span>
                                    </div>
                                </div>

                                <div class="small-box bg-red">
                                    <div class="inner">
                                        <b>Disponível:</b> <span ng-bind="dashboard.tempos_h.disponivel"></span>
                                    </div>
                                </div>

                            </div>

                            <high-chart series="dashboard.tempos_h.ocupacao" type="pie" tooltip-Point-Format="{point.y} (<b>{point.percentage:.1f}%</b>)" height="180"></high-chart>

                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!--REGIÃO-->
        <div class="col-xs-12 col-md-6 margin-bottom">
            <div class="card">
                <div class="card-header">
                    <span class="card-header-title">Incoming Calls por Região</span>
                    <div class="card-header-button card-header-expand">
                        <i class="fa fa-expand"></i>
                    </div>
                </div>
                <div class="card-body">
                    <p><small>Chamadas deste mês</small></p>
                    <mapa-brasil style="height: 727px" width="100%" dados="dashboard.mapa"></mapa-brasil>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    angular.module('app').controller('ctrl-riachuelosac', function ($scope, $http, $filter) {

        $scope.dashboard = {
            comparativo: {},
            fila: {},
            tempos_h: {},
            tempos_d: {},
        };


        $scope.dashboard.fila_categorias = [
             'Instalação Realizada'
            , 'Mudança de Equipamento'
            , 'Reenvio de Sinal'
            , 'Redirecionamento de Instalador'
            , 'Agendamento de Instalação'
            , 'Troca de Plano'
            , 'Confirmação de Venda'
            , 'Reclamação'
            , 'Dúvidas Sobre Produtos'
            , 'Ativação de Produto'
        ];
        $scope.dashboard.grafico_fila = [{
            name: 'Atendimento', data: [
                { y: 2498 },
                { y: 666 },
                { y: 1499 },
                { y: 2662 },
                { y: 2829 },
                { y: 2328 },
                { y: 2166 },
                { y: 832 },
                { y: 1832 },
                { y: 1663 },
            ]
        }];

        $scope.dashboard.pa = 140;
        $scope.dashboard.atendimentodia = 136;
        $scope.dashboard.ns = 0.944;

        $scope.dashboard.ns_gauge = {
            angle: -0.02, // The span of the gauge arc
            lineWidth: 0.25, // The line thickness
            radiusScale: 0.56, // Relative radius
            pointer: {
                length: 0.36, // // Relative to gauge radius
                strokeWidth: 0.011, // The thickness
                color: '#000000' // Fill color
            },
            limitMax: false,     // If false, max value increases automatically if value > maxValue
            limitMin: false,     // If true, the min value of the gauge will be fixed
            colorStart: '#6FADCF',   // Colors
            colorStop: '#8FC0DA',    // just experiment with them
            strokeColor: '#E0E0E0',  // to see which ones work best for you
            generateGradient: true,
            highDpiSupport: true,     // High resolution support
            minValue: 0,
            maxValue: 1,
            value: $scope.dashboard.ns,
        };

        $scope.dashboard.fila = [
            { fila: 'Instalação Realizada', ns: '92,7%', chamada: '2505', perctt: '13,16%', atendido: '2498', abandonado: '7', percaban: '0,29%', tma: '00:04:51', tmf: '00:00:14' },
            { fila: 'Mudança de Equipamento', ns: '95,0%', chamada: '668', perctt: '3,51%', atendido: '666', abandonado: '2', percaban: '0,29%', tma: '00:04:07', tmf: '00:00:15' },
            { fila: 'Reenvio de Sinal', ns: '92,6%', chamada: '1503', perctt: '7,89%', atendido: '1499', abandonado: '4', percaban: '0,29%', tma: '00:03:59', tmf: '00:00:15' },
            { fila: 'Redirecionamento de Instalador', ns: '97,4%', chamada: '2672', perctt: '14,04%', atendido: '2662', abandonado: '10', percaban: '0,39%', tma: '00:04:35', tmf: '00:00:15' },
            { fila: 'Agendamento de Instalação', ns: '92,9%', chamada: '2839', perctt: '14,91%', atendido: '2829', abandonado: '10', percaban: '0,36%', tma: '00:04:15', tmf: '00:00:15' },
            { fila: 'Troca de Plano', ns: '98,4%', chamada: '2338', perctt: '12,28%', atendido: '2328', abandonado: '10', percaban: '0,43%', tma: '00:04:07', tmf: '00:00:13' },
            { fila: 'Confirmação de Venda', ns: '93,9%', chamada: '2171', perctt: '11,40%', atendido: '2166', abandonado: '5', percaban: '0,25%', tma: '00:04:19', tmf: '00:00:13' },
            { fila: 'Reclamação', ns: '93,7%', chamada: '835', perctt: '4,39%', atendido: '832', abandonado: '3', percaban: '0,34%', tma: '00:04:31', tmf: '00:00:12' },
            { fila: 'Dúvidas Sobre Produtos', ns: '94,4%', chamada: '1837', perctt: '9,65%', atendido: '1832', abandonado: '6', percaban: '0,30%', tma: '00:04:01', tmf: '00:00:14' },
            { fila: 'Ativação de Produto', ns: '92,8%', chamada: '1670', perctt: '8,77%', atendido: '1663', abandonado: '7', percaban: '0,41%', tma: '00:04:15', tmf: '00:00:12' },
        ];

        $scope.dashboard.horas = ["08h", "09h", "10h", "11h", "12h", "13h", "14h", "15h", "16h", "17h", "18h", "19h", "20h"];

        $scope.dashboard.graficohora_h = [
            { name: 'atendido', type: 'column', data: [677, 1469, 1910, 1931, 1711, 1817, 1823, 1928, 1735, 1491, 1148, 767, 631] },
            { name: 'abandonado', type: 'column', data: [2, 5, 7, 7, 6, 6, 6, 7, 6, 5, 4, 3, 2] },
            { name: 'NS (20s)', yAxis: 1, type: 'spline', data: [92.5, 94.2, 94.0, 95.7, 92.5, 92.7, 95.3, 95.2, 94.3, 94.4, 94.7, 96.2, 95.8] }
        ];

        $scope.dashboard.mapa = [
              { id: 'BR-AC', value: 212 }
            , { id: 'BR-AL', value: 141 }
            , { id: 'BR-AM', value: 282 }
            , { id: 'BR-AP', value: 212 }
            , { id: 'BR-BA', value: 494 }
            , { id: 'BR-CE', value: 353 }
            , { id: 'BR-DF', value: 1410 }
            , { id: 'BR-ES', value: 776 }
            , { id: 'BR-GO', value: 1410 }
            , { id: 'BR-MA', value: 705 }
            , { id: 'BR-MG', value: 1622 }
            , { id: 'BR-MS', value: 846 }
            , { id: 'BR-MT', value: 776 }
            , { id: 'BR-PA', value: 494 }
            , { id: 'BR-PB', value: 282 }
            , { id: 'BR-PE', value: 564 }
            , { id: 'BR-PI', value: 282 }
            , { id: 'BR-PR', value: 423 }
            , { id: 'BR-RJ', value: 1199 }
            , { id: 'BR-RN', value: 987 }
            , { id: 'BR-RO', value: 423 }
            , { id: 'BR-RR', value: 282 }
            , { id: 'BR-RS', value: 705 }
            , { id: 'BR-SC', value: 1340 }
            , { id: 'BR-SE', value: 494 }
            , { id: 'BR-SP', value: 1762 }
            , { id: 'BR-TO', value: 564}
        ]

        $scope.dashboard.tempos_h.logado = "12:40";
        $scope.dashboard.tempos_h.conversado = "09:46";
        $scope.dashboard.tempos_h.disponivel = "01:00";
        $scope.dashboard.tempos_h.pausas = "01:52";
        $scope.dashboard.tempos_h.tma = "00:04:19";
        $scope.dashboard.tempos_h.tmf = "00:00:14";
        $scope.dashboard.tempos_h.ocupacao = [{ data: [{ name: "Conversando", y: 77.2, color: "#00a65a" }, { name: "Pausa", y: 14.8, color: "#f39c12" }, { name: "Disponivel", y: 8.0, color: "#dd4b39" }] }];

    });
</script>